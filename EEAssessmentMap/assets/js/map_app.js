//
//  filename: BCEEAssessmentEdit.js
//  Created by: Jon Duckworth
//  Created on: 5/31/14
//  Updated on: 
//
//  Description: File to create Leaflet map to display BCEE Assessment results.
//   Uses Mapquest streets baselayer, and GeoJSON files generated by PostgreSQL 
//   and OGR2OGR. JSON files are served through www.duckontheweb.com domain on Bluehost.
//

//Create elementary JSON object


var mapModel, schoolPopup, map;

var unhoverEvent = function () {
	map.closePopup();
}

var getColor = function (feature) {
		return 	(feature.properties.eehrs_total > 168) ? '#006d2c' :
				(feature.properties.eehrs_total > 126) ? '#2ca25f' :
				(feature.properties.eehrs_total > 84) ? '#66c2a4' :
				(feature.properties.eehrs_total > 42) ? '#b2e2e2' :
					'#edf8fb';
}

var getRadius = function (feature) {
		return 	(feature.properties.eehrs_total > 168) ? 12 :
				(feature.properties.eehrs_total > 126) ? 10 :
				(feature.properties.eehrs_total > 84) ? 8 :
				(feature.properties.eehrs_total > 42) ? 6 :
					4;
}


//Initializes map on window ready event
$(window).ready(function() {

	// var baseURL = 'http://localhost:8888/BCEECollaborative/EEAssessmentMap/';
	$.getJSON('./assets/data/schoolsData.json', function (geoJSON) {
		
		// Replace school district name
		$.each(geoJSON.features, function (i, element) {
			if (element.properties.district == 'Boulder Valley Re 2') {
				element.properties.district = 'Boulder Valley School District';
			} else if (element.properties.district == 'St Vrain Valley Re 1J') {
				element.properties.district = 'St. Vrain Valley School District'
			}

			if (element.properties.school == 'Columbine Elementary School (BVSD)') {
				element.properties.school = 'Columbine Elementary School';
			} else if (element.properties.school == 'Columbine Elementary School (SVVSD)') {
				element.properties.school = 'Columbine Elementary School';
			}
		})
		mapModel = new MapModel({
			data: geoJSON.features
		});

		var mapView = new MapView({
			model: mapModel
		});

		var infoView = new InfoView({
			model: mapModel
		})

		var chartView = new ChartView({
			model: mapModel
		})
	});
	
	
});

